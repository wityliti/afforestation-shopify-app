<div class="afforestation-impact-page">
  <div class="page-header">
    <h1>Our Sustainability Impact</h1>
    <p>We are committed to a greener future. Every purchase you make helps us plant trees and offset carbon.</p>
  </div>

  <div class="impact-stats">
    <div class="stat-card">
      <div class="stat-icon">ðŸŒ³</div>
      <div class="stat-value" id="forest-trees-count">Loading...</div>
      <div class="stat-label">Trees Planted</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ðŸ’¨</div>
      <div class="stat-value" id="forest-co2-count">Loading...</div>
      <div class="stat-label">kg of CO2 Offset</div>
    </div>
  </div>

  <div class="virtual-forest">
    <h2>Our Virtual Forest</h2>
    <div class="forest-grid" id="forest-grid">
      <!-- Trees will be rendered here via JS -->
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', async function() {
    const treesEl = document.getElementById('forest-trees-count');
    const co2El = document.getElementById('forest-co2-count');
    const forestGrid = document.getElementById('forest-grid');

    try {
      const response = await fetch('/apps/afforestation/impact');
      if (response.ok) {
        const data = await response.json();
        treesEl.textContent = data.treesPlanted.toLocaleString();
        co2El.textContent = data.co2Offset.toLocaleString();
        
        // Render trees based on actual count (max 50 for display)
        const treesToShow = Math.min(data.treesPlanted, 50);
        for (let i = 0; i < treesToShow; i++) {
          const tree = document.createElement('span');
          tree.textContent = 'ðŸŒ²';
          tree.style.fontSize = '24px';
          forestGrid.appendChild(tree);
        }
      } else {
        throw new Error('Failed to fetch');
      }
    } catch (error) {
      // Fallback to placeholder data if proxy fails
      treesEl.textContent = '0';
      co2El.textContent = '0';
      console.warn('Afforestation: Could not load impact data', error);
    }
  });
</script>

{% schema %}
{
  "name": "Virtual Forest Page",
  "target": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Our Sustainability Impact" }
  ]
}
{% endschema %}

<style>
  .afforestation-impact-page {
    max-width: 1000px;
    margin: 40px auto;
    padding: 0 20px;
    text-align: center;
    font-family: sans-serif;
  }
  .impact-stats {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin: 40px 0;
  }
  .stat-card {
    background: #f8fcf8;
    border: 1px solid #e0eee0;
    border-radius: 12px;
    padding: 30px;
    min-width: 200px;
  }
  .stat-icon { font-size: 40px; margin-bottom: 10px; }
  .stat-value { font-size: 32px; font-weight: bold; color: #2d5a27; }
  .stat-label { color: #666; margin-top: 5px; }
  .forest-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-top: 20px;
    padding: 20px;
    background: #fdfdfd;
    border-radius: 12px;
  }
</style>
