{% comment %}
  Afforestation Impact Banner
  A header/announcement bar style widget showing climate commitment
{% endcomment %}

<div class="afforestation-banner" id="afforestation-banner-{{ block.id }}" style="display: none;">
  <div class="banner-content">
    <span class="banner-icon" id="banner-icon-{{ block.id }}">ðŸŒ³</span>
    <span class="banner-text" id="banner-text-{{ block.id }}">
      <strong id="banner-value-{{ block.id }}">1%</strong> of every order funds climate action
    </span>
    <span class="banner-badge" id="banner-badge-{{ block.id }}">
      <span class="banner-brand">Afforestation</span>
    </span>
  </div>
</div>

<script>
  (function() {
    const blockId = '{{ block.id }}';
    const banner = document.getElementById('afforestation-banner-' + blockId);
    const iconEl = document.getElementById('banner-icon-' + blockId);
    const textEl = document.getElementById('banner-text-' + blockId);
    const valueEl = document.getElementById('banner-value-' + blockId);
    const badgeEl = document.getElementById('banner-badge-' + blockId);
    
    async function loadSettings() {
      try {
        const response = await fetch('/apps/afforestation/impact');
        if (!response.ok) throw new Error('Failed to fetch');
        
        const data = await response.json();
        const s = data.settings || {};
        
        // Check if banner is enabled
        if (s.bannerEnabled === false) {
          banner.style.display = 'none';
          return;
        }
        
        // Show banner
        banner.style.display = 'block';
        
        // Apply styling based on style
        let padding = '10px 20px';
        let fontSize = '14px';
        let fontWeight = '400';
        
        if (s.bannerStyle === 'compact') {
          padding = '6px 16px';
          fontSize = '13px';
        } else if (s.bannerStyle === 'bold') {
          padding = '14px 24px';
          fontSize = '16px';
          fontWeight = '600';
        }
        
        banner.style.setProperty('--banner-bg', s.primaryColor || '#2d5a27');
        banner.style.setProperty('--banner-text', '#ffffff');
        banner.style.padding = padding;
        banner.style.fontSize = fontSize;
        banner.style.fontWeight = fontWeight;
        
        // Update icon based on impact type
        if (s.impactType === 'carbon') {
          iconEl.textContent = 'ðŸ’¨';
        } else if (s.impactType === 'both') {
          iconEl.textContent = 'ðŸŒ';
        } else {
          iconEl.textContent = s.bannerIcon || s.treeEmoji || 'ðŸŒ³';
        }
        
        // Update message
        let message = s.bannerMessage || '{percent}% of every order funds climate action';
        
        if (s.triggerType === 'percentage') {
          message = message.replace('{percent}', s.triggerValue || '1');
          message = message.replace('{count}', s.triggerValue || '1');
        } else if (s.triggerType === 'fixed') {
          const count = s.triggerValue || 1;
          message = count + ' tree' + (count > 1 ? 's' : '') + ' planted with every order';
        } else if (s.triggerType === 'threshold') {
          message = '1 tree for every $' + (s.triggerValue || 50) + ' spent';
        }
        
        textEl.innerHTML = message;
        
        // Show/hide branding
        if (s.showBannerBranding === false) {
          badgeEl.style.display = 'none';
        }
        
      } catch (error) {
        console.warn('Afforestation: Could not load settings', error);
        // Show default banner on error
        banner.style.display = 'block';
      }
    }
    
    loadSettings();
  })();
</script>

{% schema %}
{
  "name": "Impact Announcement Bar",
  "target": "section",
  "settings": [
    {
      "type": "paragraph",
      "content": "Display a banner showing your climate commitment. Styling is configured in the Afforestation app."
    }
  ]
}
{% endschema %}

<style>
  .afforestation-banner {
    --banner-bg: #2d5a27;
    --banner-text: #ffffff;
    
    background: var(--banner-bg);
    color: var(--banner-text);
    padding: 10px 20px;
    text-align: center;
    font-size: 14px;
  }
  
  .afforestation-banner .banner-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
  }
  
  .afforestation-banner .banner-icon {
    font-size: 18px;
  }
  
  .afforestation-banner .banner-text {
    color: var(--banner-text);
  }
  
  .afforestation-banner .banner-text strong {
    font-weight: 700;
  }
  
  .afforestation-banner .banner-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 20px;
  }
  
  .afforestation-banner .banner-brand {
    font-weight: 600;
    font-size: 12px;
    letter-spacing: 0.5px;
  }
  
  @media (max-width: 480px) {
    .afforestation-banner {
      padding: 8px 12px;
      font-size: 12px;
    }
    
    .afforestation-banner .banner-badge {
      display: none;
    }
  }
</style>
